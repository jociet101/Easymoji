<!DOCTYPE html>
<html>
<head>
  <title>Easymoji</title>

  <!-- CSS -->
  <link rel="stylesheet" type="text/css" href="index.css" />

  <!-- Logo Icon -->
  <link rel="icon" type="image/x-icon" href="Moji.png" />

</head>
<body>
    <h1 class="the-title">
        <img src="Moji.png" style="width:60px;height:50px;">
        Easymoji  
    </h1>
    <div style="float: right;">
        <input type="checkbox" id="sound" name="sound">
        <label for="sound">Mystery Feature</label>
    </div>
    <br><br>
    <a href="https://github.com/jociet101/easymoji/blob/main/README.md" target="_blank"><span class="question" style="float: right;">?</span></a>
    <br><br>
    <div class="grid-container">
        <div class = "code-area">
            <div class = "code-area-header-editor">
                <h1>Editor</h1>
                <button onclick="compile()">Compile</button>
            </div>
            <textarea id="user_input" class="code-box" name="user_input"></textarea>
        </div>
        <div class = "code-area">
            <div class = "code-area-header-shell">
                <h1>Shell</h1>
                <button onclick="clearCode()">Clear</button> &nbsp;
                <button onclick="copyCode()">Copy</button>
            </div>
            <textarea id="output" class="code-box" name="output" ></textarea>
        </div>
    </div>
</body>
<script>
    (()=>{
        const console_log = window.console.log;
        window.console.log = function(...args){
            console_log(...args);
            var textarea = document.getElementById('output');
            if(!textarea) return;
            args.forEach(arg=>textarea.value += `${arg}\n`);
        }
    })();

    const compile = async () => {
        var sound = document.getElementById("sound").checked;
        if (sound) {
            const audio = new Audio("compile.mp3");
            audio.play();
        }

        var user_in = document.getElementById("user_input").value;
        
        const rawResponse = await fetch('http://localhost:3000/codegen', {
            method: 'POST',
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ "user_input": user_in })
        });
        var content = await rawResponse.json();
        try{
            eval(content);
        } catch (e) {
            content = content.substring(0,content.length-1);
            if(content.lastIndexOf("\n")>0) {
                console.log(content.substring(content.lastIndexOf("\n")+1, content.length));
            } else {
                console.log(content);
            }
        }
    }

    const clearCode = async () => {
        var sound = document.getElementById("sound").checked;
        if (sound) {
            const audio = new Audio("clear.mp3");
            audio.play();
        }

        var textarea = document.getElementById('output');
        textarea.value = '';
    }

    const copyCode = async () => {
        var sound = document.getElementById("sound").checked;
        if (sound) {
            const audio = new Audio("copy.mp3");
            audio.play();
        }

        var textarea = document.getElementById("output");
        textarea.select();
        document.execCommand("copy");
    }
</script>
</html>